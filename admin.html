<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>JNK Express Padala ‚Äî Track Your Package</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Track your JNK Express Padala packages. Enter tracking number, see current status, estimated delivery and map preview." />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    /* Reset + base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html,body { height:100%; }
    body {
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(120deg,#f7f9fb 0%, #f1f4f6 50%, #fff 100%);
      color: #222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height: 100%;
      padding-bottom: 80px;
    }

    /* subtle animated gradient band at top */
    .top-gradient {
      position: fixed;
      inset: 0 0 auto 0;
      height: 180px;
      background: linear-gradient(90deg, rgba(215,40,47,0.10), rgba(215,40,47,0.04));
      pointer-events: none;
      z-index: 0;
      animation: slowShift 12s linear infinite;
    }
    @keyframes slowShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* header */
    header {
      position: relative;
      z-index: 2;
      background: linear-gradient(90deg,#D7282F,#b51e25);
      color: #fff;
      padding: 14px 20px;
      display:flex;
      align-items:center;
      gap:12px;
      justify-content: space-between;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }
    header img { height:48px; border-radius:8px; display:block; }
    header h1 { font-size:1.25rem; font-weight:700; margin-left:8px; flex:1; }
    .admin-link { background: rgba(255,255,255,0.12); padding:8px 12px; border-radius:8px; color:#fff; text-decoration:none; font-weight:600; }

    /* nav */
    nav { margin-top: 10px; padding: 10px 18px; display:flex; justify-content:center; gap:10px; z-index:2; position: relative; }
    nav button {
      background:#fff; color:#D7282F; border:1px solid #D7282F; padding:9px 14px; border-radius:8px; cursor:pointer; font-weight:700;
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease, color .18s ease;
    }
    nav button:hover { transform: translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.08); background:#D7282F; color:white; }

    /* center card */
    .container {
      max-width:760px;
      margin: 34px auto;
      position: relative;
      z-index: 2;
      padding: 2rem;
    }

    .card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(15,23,42,0.06);
      padding: 26px;
      text-align:center;
      transition: transform .22s ease, box-shadow .22s ease;
    }
    .card:hover { transform: translateY(-6px); box-shadow: 0 20px 40px rgba(15,23,42,0.08); }

    h2 { margin: 0 0 8px 0; font-size:1.4rem; color:#111; }
    p.lead { color: #555; margin-bottom: 16px; }

    .tracking-bar { display:flex; gap:10px; margin-top: 12px; align-items:center; }
    .tracking-bar input {
      flex: 1;
      padding: 12px 14px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #e6e6e6;
      transition: box-shadow .18s ease, border-color .18s ease;
    }
    .tracking-bar input:focus { outline:none; box-shadow: 0 6px 20px rgba(215,40,47,0.08); border-color: #D7282F; }

    .btn-primary {
      background: linear-gradient(180deg,#D7282F,#b51e25);
      color:#fff;
      border:none;
      padding: 12px 16px;
      border-radius: 10px;
      font-weight:700;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow:0 10px 24px rgba(183,30,37,0.18); }

    #loading { display:none; margin-top:12px; color:#D7282F; font-weight:700; }

    /* result card */
    .result {
      margin-top:18px;
      background: linear-gradient(180deg,#fff,#fffaf9);
      border-radius: 12px;
      padding: 18px;
      text-align:left;
      display:none;
      box-shadow: 0 8px 26px rgba(15,23,42,0.04);
      transition: opacity .25s ease, transform .25s ease;
    }
    .result.show { display:block; opacity:1; transform: translateY(0); }

    .result .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .result .col { flex:1; min-width:160px; }
    .result .label { font-weight:700; color:#555; font-size:0.92rem; }
    .result .value { color:#111; font-weight:700; margin-top:6px; }

    /* timeline (horizontal) */
    .timeline {
      margin-top:16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .timeline-step {
      flex:1;
      text-align:center;
      position:relative;
      padding:6px 4px;
      transition: transform .22s ease, opacity .22s ease;
      opacity:0.45;
    }
    .timeline-step::after {
      content:"";
      position:absolute;
      top:22px;
      right:-50%;
      width:100%;
      height:4px;
      background:#eee;
      z-index:-1;
    }
    .timeline-step:last-child::after { display:none; }
    .timeline-step .icon {
      width:48px;height:48px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;
      background:#f0f0f0;color:#666;font-size:20px; margin:0 auto;
      transition: box-shadow .2s ease, transform .2s ease, background .2s ease;
    }
    .timeline-step.active { opacity:1; transform: translateY(-6px); }
    .timeline-step.active .icon {
      background: linear-gradient(180deg,#D7282F,#b51e25);
      color:white;
      box-shadow: 0 10px 26px rgba(215,40,47,0.18);
      animation: glowPulse 1.6s infinite;
    }
    .timeline-step .label { margin-top:8px; font-size:0.85rem; color:#444; font-weight:600; }

    @keyframes glowPulse {
      0% { box-shadow:0 8px 18px rgba(215,40,47,0.18); transform: scale(1); }
      50% { box-shadow:0 14px 32px rgba(215,40,47,0.28); transform: scale(1.03); }
      100% { box-shadow:0 8px 18px rgba(215,40,47,0.18); transform: scale(1); }
    }

    /* map */
    .map { margin-top:14px; border-radius:10px; overflow:hidden; }

    /* info blocks below */
    .card-block { margin: 20px auto; max-width:760px; padding:18px; background:#fff;border-radius:12px; box-shadow:0 8px 24px rgba(15,23,42,0.04); }
    .card-block h3 { color:#D7282F; margin-bottom:8px; }
    .card-block ul { margin-left:18px; margin-top:8px; color:#333; }

    /* support */
    .support-btn { position: fixed; right: 20px; bottom: 88px; z-index: 40; background:#D7282F; color:white; padding:12px 16px; border-radius:999px; box-shadow:0 8px 24px rgba(0,0,0,0.12); cursor:pointer; border:none; font-weight:700; }
    .support-panel { position: fixed; right: 20px; bottom: 150px; width:320px; background:#fff; box-shadow:0 14px 34px rgba(15,23,42,0.1); padding:12px; border-radius:12px; display:none; z-index:41; }
    .support-panel input, .support-panel textarea { width:100%; padding:10px;border-radius:8px;border:1px solid #e6e6e6;margin-top:8px; }

    /* collapsible */
    .collapsible { width:100%; padding:12px; border-radius:8px; border:none; background:#D7282F;color:#fff; font-weight:700; cursor:pointer; }
    .content { display:none; padding:10px 6px; background:#fff; border-left:3px solid #D7282F; margin-top:8px; border-radius:6px; }

    /* footer */
    footer { background:#D7282F; color:#fff; padding:18px 10px; margin-top:22px; text-align:center; }

    /* small screens */
    @media (max-width:720px) {
      .timeline-step::after { display:none; }
      .timeline { gap:6px; }
      .timeline-step { transform: none; }
    }
  </style>
</head>
<body>
  <div class="top-gradient" aria-hidden="true"></div>

  <header>
    <div style="display:flex; align-items:center; gap:10px;">
      <img src="logo.jpg" alt="JNK logo" />
      <h1>JNK Express Padala</h1>
    </div>
    <a class="admin-link" href="admin.html">Admin</a>
  </header>

  <nav>
    <button onclick="document.getElementById('trackingInput').focus()">Track & Trace</button>
    <button onclick="alert('Shipping Rates - Coming Soon')">Shipping Rates</button>
    <button onclick="alert('Shipping Days - Coming Soon')">Shipping Days</button>
    <button onclick="alert('Find Branches - Coming Soon')">Find Branches</button>
  </nav>

  <main class="container" role="main">
    <div class="card" aria-live="polite">
      <h2>Track Your Package</h2>
      <p class="lead">Enter your tracking number below to see current status, estimated delivery and location.</p>

      <div class="tracking-bar" role="search" aria-label="Track package">
        <input id="trackingInput" type="text" placeholder="Enter your tracking number" aria-label="Tracking number" />
        <button class="btn-primary" onclick="trackPackage()">Track</button>
      </div>

      <div id="loading" aria-hidden="true">‚è≥ Loading...</div>

      <div id="resultCard" class="result" role="region" aria-labelledby="trackingLabel">
        <!-- dynamic content inserted here -->
        <div id="statusResultInner"></div>
      </div>
    </div>
  </main>

  <!-- services & locations -->
  <section class="card-block" aria-labelledby="servicesTitle">
    <h3 id="servicesTitle">Our Services</h3>
    <p><strong>Package Courier:</strong> Fast delivery from Urban to Lubang and vice versa.</p>
    <p><strong>Sea Freight:</strong> Best rates, starting at just ‚Ç±20.</p>
    <p><strong>Bulk/Truck Services:</strong> Large shipments handled with care.</p>
  </section>

  <section class="card-block" aria-labelledby="locationsTitle">
    <h3 id="locationsTitle">üìç Pick-up Locations</h3>
    <ul>
      <li>Main Branch: Urban Finds by JNK ‚Äî Andres Bonifacio HW</li>
      <li>Tilik: E. Arnaldo St. (Near NFA warehouse)</li>
      <li>Vigo/Dangay: Near Dangay Church</li>
      <li>Tagbac: 104 Guijo St.</li>
      <li>Binacas: 213 Kasoy St.</li>
      <li>Cabra: 037 Bayabas St.</li>
    </ul>
  </section>

  <section class="card-block" aria-labelledby="policiesTitle">
    <h3 id="policiesTitle">About & Policies</h3>

    <button class="collapsible">About Us</button>
    <div class="content"><p>JNK Express Padala provides reliable and timely deliveries between Urban and Lubang.</p></div>

    <button class="collapsible">Privacy Policy</button>
    <div class="content"><p>We protect your data and use it only to provide delivery services. We do not sell personal information.</p></div>

    <button class="collapsible">Terms & Conditions</button>
    <div class="content"><p>By using our services you agree to provide accurate parcel details. JNK is not liable for delays due to unforeseen events.</p></div>
  </section>

  <!-- support -->
  <button class="support-btn" onclick="toggleSupport()">üí¨ Support</button>
  <div class="support-panel" id="supportPanel" aria-hidden="true">
    <form action="https://formsubmit.co/jhonyhix@gmail.com" method="POST">
      <input type="hidden" name="_captcha" value="false">
      <input name="Name" placeholder="Your name" required />
      <input name="TrackingNumber" placeholder="Tracking number (optional)" />
      <textarea name="Message" rows="4" placeholder="Message" required></textarea>
      <div style="display:flex; gap:8px; margin-top:10px;">
        <button type="submit" style="flex:1; background:#D7282F; color:#fff; border:none; padding:10px; border-radius:8px; cursor:pointer;">Send</button>
        <button type="button" style="flex:0 0 auto; background:#f3f3f3; border:none; padding:10px; border-radius:8px; cursor:pointer;" onclick="toggleSupport()">Close</button>
      </div>
    </form>
  </div>

  <footer>
    &copy; <span id="year"></span> JNK Express Padala ‚Ä¢ <a href="https://www.facebook.com/profile.php?id=61572021585621" style="color:#fff; text-decoration:underline">Facebook</a>
  </footer>

  <script>
    // set year
    document.getElementById('year').innerText = new Date().getFullYear();

    /* Firebase config (same as admin) */
    const firebaseConfig = {
      apiKey: "AIzaSyAnrNfuTSRAKUS2tAU4AUUrauw_QzszCjY",
      authDomain: "jnk-ordertracker.firebaseapp.com",
      projectId: "jnk-ordertracker",
      storageBucket: "jnk-ordertracker.appspot.com",
      messagingSenderId: "421193030070",
      appId: "1:421193030070:web:078e39980237bc41f64917"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Stages (horizontal order)
    const STAGES = [
      { name: "Package Received", icon: "üì¶" },
      { name: "In Transit", icon: "üöö" },
      { name: "Arrived", icon: "üìç" },
      { name: "For Pick-up", icon: "‚úÖ" }
    ];

    // Helper: determine active stage index from status text (case-insensitive)
    function findStageIndex(statusText) {
      if (!statusText) return -1;
      const s = statusText.toString().trim().toLowerCase();
      for (let i = 0; i < STAGES.length; i++) {
        if (STAGES[i].name.toLowerCase() === s) return i;
      }
      // try partial matches
      for (let i = 0; i < STAGES.length; i++) {
        if (s.includes(STAGES[i].name.toLowerCase().split(" ")[0])) return i;
      }
      return -1;
    }

    // Toggle support panel
    function toggleSupport() {
      const p = document.getElementById('supportPanel');
      p.style.display = (p.style.display === 'block') ? 'none' : 'block';
      p.setAttribute('aria-hidden', p.style.display === 'none' ? 'true' : 'false');
    }

    // Collapsibles
    document.querySelectorAll('.collapsible').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        btn.classList.toggle('active');
        const content = btn.nextElementSibling;
        content.style.display = content.style.display === 'block' ? 'none' : 'block';
      });
    });

    // Track package function (uses your working retrieval logic; UI enhanced)
    async function trackPackage() {
      const inputEl = document.getElementById('trackingInput');
      const input = inputEl.value.trim().toUpperCase();
      const resultCard = document.getElementById('resultCard');
      const inner = document.getElementById('statusResultInner');
      const loading = document.getElementById('loading');
      const mapContainer = document.getElementById('mapContainer');

      // reset UI
      inner.innerHTML = '';
      resultCard.classList.remove('show');
      mapContainer.innerHTML = '';
      mapContainer.style.display = 'none';
      loading.style.display = 'block';

      if (!input) { alert('Enter tracking number'); loading.style.display = 'none'; inputEl.focus(); return; }

      try {
        let data = null;

        // Try doc ID first
        const docSnap = await db.collection('tracking').doc(input).get();
        if (docSnap.exists) {
          data = docSnap.data();
        } else {
          // fallback: search by field trackingNumber
          const q = await db.collection('tracking').where('trackingNumber','==', input).limit(1).get();
          if (!q.empty) data = q.docs[0].data();
        }

        if (!data) {
          inner.innerHTML = `<p style="color:#c0392b; font-weight:700;">‚ùå Tracking number not found. Please double-check and try again or contact support.</p>`;
          resultCard.classList.add('show');
          loading.style.display = 'none';
          return;
        }

        // Extract required fields (we omit price, parcelName, barangay per your request)
        const status = data.status || "Unknown";
        const destination = data.destination || data.dest || "N/A";
        const estimated = data.estimatedDate || data.estimated || "Not available";

        // Build result HTML
        const activeIndex = findStageIndex(status);

        // top info row
        let html = `
          <div class="row">
            <div class="col">
              <div class="label">Tracking</div>
              <div class="value">${input}</div>
            </div>
            <div class="col">
              <div class="label">Current Status</div>
              <div class="value">${status}</div>
            </div>
            <div class="col">
              <div class="label">Destination</div>
              <div class="value">${destination}</div>
            </div>
            <div class="col">
              <div class="label">Estimated Delivery</div>
              <div class="value">${estimated}</div>
            </div>
          </div>
        `;

        // timeline
        html += `<div class="timeline" aria-hidden="false">`;
        STAGES.forEach((stage, idx) => {
          html += `
            <div class="timeline-step ${idx === activeIndex ? 'active' : ''}" aria-current="${idx === activeIndex ? 'true' : 'false'}">
              <div class="icon" title="${stage.name}">${stage.icon}</div>
              <div class="label">${stage.name}</div>
            </div>`;
        });
        html += `</div>`;

        inner.innerHTML = html;
        resultCard.classList.add('show');

        // map handling: if data.location exists, try to parse "lat,lng" or treat as address text
        if (data.location && typeof data.location === 'string' && data.location.trim()) {
          const loc = data.location.trim();
          let mapSrc = '';
          // if looks like coordinates (lat,lng)
          const maybeCoords = loc.split(',').map(s => s.trim());
          if (maybeCoords.length === 2 && !isNaN(parseFloat(maybeCoords[0])) && !isNaN(parseFloat(maybeCoords[1]))) {
            const lat = encodeURIComponent(maybeCoords[0]);
            const lng = encodeURIComponent(maybeCoords[1]);
            mapSrc = `https://maps.google.com/maps?q=${lat},${lng}&z=14&output=embed`;
          } else {
            // treat as address string
            mapSrc = `https://maps.google.com/maps?q=${encodeURIComponent(loc)}&z=14&output=embed`;
          }
          mapContainer.innerHTML = `<div class="map"><iframe src="${mapSrc}" width="100%" height="300" style="border:0;border-radius:8px;" loading="lazy" referrerpolicy="no-referrer-when-downgrade" allowfullscreen></iframe></div>`;
          mapContainer.style.display = 'block';
        }

      } catch (err) {
        console.error('Error fetching tracking:', err);
        inner.innerHTML = `<p style="color:#c0392b; font-weight:700;">‚ö†Ô∏è Error retrieving data. Please try again later.</p>`;
        resultCard.classList.add('show');
      } finally {
        loading.style.display = 'none';
      }
    }

    // keyboard: Enter key triggers track
    document.getElementById('trackingInput').addEventListener('keydown', function(e){
      if (e.key === 'Enter') trackPackage();
    });

    // back to top (small)
    const backBtn = document.createElement('button');
    backBtn.id = 'backToTop';
    backBtn.textContent = '‚Üë Top';
    backBtn.style.cssText = 'position:fixed;right:20px;bottom:20px;padding:10px 14px;border-radius:999px;border:none;background:#D7282F;color:#fff;cursor:pointer;display:none;z-index:9999;';
    document.body.appendChild(backBtn);
    backBtn.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));
    window.addEventListener('scroll', ()=> backBtn.style.display = window.scrollY > 240 ? 'block' : 'none');

  </script>
</body>
</html>
