<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>JNK Admin Panel</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js">
function exportTrackingExcel(entries){
  if(!entries || entries.length === 0){
    alert("No entries to export.");
    return;
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers
  aoa.push(["Tracking #","Parcel Name","Barangay","Price","Status","Date"]);

  // Data rows
  entries.forEach(r=>{
    aoa.push([r.id, r.name||"", r.barangay||"", r.price||"", r.status||"", r.ts ? r.ts.toLocaleString() : ""]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Tracking Entries");
  XLSX.writeFile(wb, `tracking_entries_${Date.now()}.xlsx`);
}

function exportAnalyticsExcel(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers + data
  aoa.push(["Date","Tracking #","Parcel Name","Barangay","Price"]);
  window.__analyticsRows.forEach(r=>{
    aoa.push([r.ts.toLocaleDateString(), r.id, r.name, r.barangay, r.price]);
  });

  // Daily Summary
  aoa.push([]);
  aoa.push(["Daily Summary"]);
  (window.__analyticsDaily||[]).forEach(d=>{
    aoa.push([d.date, d.parcels, "", "", d.revenue]);
  });

  // Barangay Distribution
  aoa.push([]);
  aoa.push(["Barangay Distribution"]);
  (window.__analyticsBarangay||[]).forEach(b=>{
    aoa.push([b.barangay, b.count]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Analytics");
  XLSX.writeFile(wb, `analytics_export_${Date.now()}.xlsx`);
}

async function exportAnalyticsPDF(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", [216, 356]); // Legal size

  // === Header ===
  doc.setFontSize(16);
  doc.setTextColor(0,0,0);
  doc.text("JNK Express Padala", 14, 12);
  doc.setFontSize(10);
  doc.text(`Date Generated: ${new Date().toLocaleString()}`, 14, 18);

  // === KPIs ===
  doc.setFontSize(11);
  doc.setTextColor(215, 40, 47);
  doc.text("Key Metrics", 14, 30);

  doc.setTextColor(0,0,0);
  let kpiY = 38;
  doc.text(`Total Parcels: ${document.getElementById("kpiParcels").innerText}`, 14, kpiY);
  doc.text(`Total Revenue: ‚Ç±${document.getElementById("kpiRevenue").innerText}`, 110, kpiY);
  kpiY += 8;
  doc.text(`Average Price: ‚Ç±${document.getElementById("kpiAvg").innerText}`, 14, kpiY);
  doc.text(`Repeat Customers: ${document.getElementById("kpiRepeat").innerText}`, 110, kpiY);

  // === Charts ===
  const chart1 = document.getElementById("chartParcels");
  const chart2 = document.getElementById("chartRevenue");
  const chart3 = document.getElementById("chartBarangay");

  let yCharts = 60;
  if(chart1){
    const img1 = chart1.toDataURL("image/png", 1.0);
    doc.addImage(img1, "PNG", 14, yCharts, 85, 60);
    doc.text("Daily Parcels", 14, yCharts-2);
  }
  if(chart2){
    const img2 = chart2.toDataURL("image/png", 1.0);
    doc.addImage(img2, "PNG", 110, yCharts, 85, 60);
    doc.text("Daily Revenue", 110, yCharts-2);
  }
  if(chart3){
    const img3 = chart3.toDataURL("image/png", 1.0);
    doc.addImage(img3, "PNG", 14, yCharts+70, 85, 60);
    doc.text("Barangay Distribution", 14, yCharts+68);
  }

  // === Top Barangays ===
  doc.setFontSize(12);
  doc.setTextColor(215, 40, 47);
  doc.text("Top Barangays", 110, yCharts+68);

  doc.setFontSize(9);
  doc.setTextColor(0,0,0);
  let yTable = yCharts + 76;
  const rows = (window.__analyticsBarangay || []).slice(0,8);
  rows.forEach((r, i)=>{
    doc.text(`${i+1}. ${r.barangay}`, 110, yTable + (i*6));
    doc.text(`${r.count}`, 180, yTable + (i*6), {align:"right"});
  });

  // === Footer ===
  doc.setFontSize(9);
  doc.setTextColor(150,150,150);
  doc.text("JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021", 14, 350);

  // === Filename with date range ===
  const fromEl = document.getElementById("anaFrom").value;
  const toEl   = document.getElementById("anaTo").value;
  let filename = "analytics_dashboard.pdf";
  if(fromEl && toEl){
    filename = `analytics_dashboard_${fromEl}_to_${toEl}.pdf`;
  }

  doc.save(filename);
}

</script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js">
function exportTrackingExcel(entries){
  if(!entries || entries.length === 0){
    alert("No entries to export.");
    return;
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers
  aoa.push(["Tracking #","Parcel Name","Barangay","Price","Status","Date"]);

  // Data rows
  entries.forEach(r=>{
    aoa.push([r.id, r.name||"", r.barangay||"", r.price||"", r.status||"", r.ts ? r.ts.toLocaleString() : ""]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Tracking Entries");
  XLSX.writeFile(wb, `tracking_entries_${Date.now()}.xlsx`);
}

function exportAnalyticsExcel(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers + data
  aoa.push(["Date","Tracking #","Parcel Name","Barangay","Price"]);
  window.__analyticsRows.forEach(r=>{
    aoa.push([r.ts.toLocaleDateString(), r.id, r.name, r.barangay, r.price]);
  });

  // Daily Summary
  aoa.push([]);
  aoa.push(["Daily Summary"]);
  (window.__analyticsDaily||[]).forEach(d=>{
    aoa.push([d.date, d.parcels, "", "", d.revenue]);
  });

  // Barangay Distribution
  aoa.push([]);
  aoa.push(["Barangay Distribution"]);
  (window.__analyticsBarangay||[]).forEach(b=>{
    aoa.push([b.barangay, b.count]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Analytics");
  XLSX.writeFile(wb, `analytics_export_${Date.now()}.xlsx`);
}

async function exportAnalyticsPDF(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", [216, 356]); // Legal size

  // === Header ===
  doc.setFontSize(16);
  doc.setTextColor(0,0,0);
  doc.text("JNK Express Padala", 14, 12);
  doc.setFontSize(10);
  doc.text(`Date Generated: ${new Date().toLocaleString()}`, 14, 18);

  // === KPIs ===
  doc.setFontSize(11);
  doc.setTextColor(215, 40, 47);
  doc.text("Key Metrics", 14, 30);

  doc.setTextColor(0,0,0);
  let kpiY = 38;
  doc.text(`Total Parcels: ${document.getElementById("kpiParcels").innerText}`, 14, kpiY);
  doc.text(`Total Revenue: ‚Ç±${document.getElementById("kpiRevenue").innerText}`, 110, kpiY);
  kpiY += 8;
  doc.text(`Average Price: ‚Ç±${document.getElementById("kpiAvg").innerText}`, 14, kpiY);
  doc.text(`Repeat Customers: ${document.getElementById("kpiRepeat").innerText}`, 110, kpiY);

  // === Charts ===
  const chart1 = document.getElementById("chartParcels");
  const chart2 = document.getElementById("chartRevenue");
  const chart3 = document.getElementById("chartBarangay");

  let yCharts = 60;
  if(chart1){
    const img1 = chart1.toDataURL("image/png", 1.0);
    doc.addImage(img1, "PNG", 14, yCharts, 85, 60);
    doc.text("Daily Parcels", 14, yCharts-2);
  }
  if(chart2){
    const img2 = chart2.toDataURL("image/png", 1.0);
    doc.addImage(img2, "PNG", 110, yCharts, 85, 60);
    doc.text("Daily Revenue", 110, yCharts-2);
  }
  if(chart3){
    const img3 = chart3.toDataURL("image/png", 1.0);
    doc.addImage(img3, "PNG", 14, yCharts+70, 85, 60);
    doc.text("Barangay Distribution", 14, yCharts+68);
  }

  // === Top Barangays ===
  doc.setFontSize(12);
  doc.setTextColor(215, 40, 47);
  doc.text("Top Barangays", 110, yCharts+68);

  doc.setFontSize(9);
  doc.setTextColor(0,0,0);
  let yTable = yCharts + 76;
  const rows = (window.__analyticsBarangay || []).slice(0,8);
  rows.forEach((r, i)=>{
    doc.text(`${i+1}. ${r.barangay}`, 110, yTable + (i*6));
    doc.text(`${r.count}`, 180, yTable + (i*6), {align:"right"});
  });

  // === Footer ===
  doc.setFontSize(9);
  doc.setTextColor(150,150,150);
  doc.text("JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021", 14, 350);

  // === Filename with date range ===
  const fromEl = document.getElementById("anaFrom").value;
  const toEl   = document.getElementById("anaTo").value;
  let filename = "analytics_dashboard.pdf";
  if(fromEl && toEl){
    filename = `analytics_dashboard_${fromEl}_to_${toEl}.pdf`;
  }

  doc.save(filename);
}

</script>
<!-- Chart / Export libs used previously -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js">
function exportTrackingExcel(entries){
  if(!entries || entries.length === 0){
    alert("No entries to export.");
    return;
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers
  aoa.push(["Tracking #","Parcel Name","Barangay","Price","Status","Date"]);

  // Data rows
  entries.forEach(r=>{
    aoa.push([r.id, r.name||"", r.barangay||"", r.price||"", r.status||"", r.ts ? r.ts.toLocaleString() : ""]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Tracking Entries");
  XLSX.writeFile(wb, `tracking_entries_${Date.now()}.xlsx`);
}

function exportAnalyticsExcel(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers + data
  aoa.push(["Date","Tracking #","Parcel Name","Barangay","Price"]);
  window.__analyticsRows.forEach(r=>{
    aoa.push([r.ts.toLocaleDateString(), r.id, r.name, r.barangay, r.price]);
  });

  // Daily Summary
  aoa.push([]);
  aoa.push(["Daily Summary"]);
  (window.__analyticsDaily||[]).forEach(d=>{
    aoa.push([d.date, d.parcels, "", "", d.revenue]);
  });

  // Barangay Distribution
  aoa.push([]);
  aoa.push(["Barangay Distribution"]);
  (window.__analyticsBarangay||[]).forEach(b=>{
    aoa.push([b.barangay, b.count]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Analytics");
  XLSX.writeFile(wb, `analytics_export_${Date.now()}.xlsx`);
}

async function exportAnalyticsPDF(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", [216, 356]); // Legal size

  // === Header ===
  doc.setFontSize(16);
  doc.setTextColor(0,0,0);
  doc.text("JNK Express Padala", 14, 12);
  doc.setFontSize(10);
  doc.text(`Date Generated: ${new Date().toLocaleString()}`, 14, 18);

  // === KPIs ===
  doc.setFontSize(11);
  doc.setTextColor(215, 40, 47);
  doc.text("Key Metrics", 14, 30);

  doc.setTextColor(0,0,0);
  let kpiY = 38;
  doc.text(`Total Parcels: ${document.getElementById("kpiParcels").innerText}`, 14, kpiY);
  doc.text(`Total Revenue: ‚Ç±${document.getElementById("kpiRevenue").innerText}`, 110, kpiY);
  kpiY += 8;
  doc.text(`Average Price: ‚Ç±${document.getElementById("kpiAvg").innerText}`, 14, kpiY);
  doc.text(`Repeat Customers: ${document.getElementById("kpiRepeat").innerText}`, 110, kpiY);

  // === Charts ===
  const chart1 = document.getElementById("chartParcels");
  const chart2 = document.getElementById("chartRevenue");
  const chart3 = document.getElementById("chartBarangay");

  let yCharts = 60;
  if(chart1){
    const img1 = chart1.toDataURL("image/png", 1.0);
    doc.addImage(img1, "PNG", 14, yCharts, 85, 60);
    doc.text("Daily Parcels", 14, yCharts-2);
  }
  if(chart2){
    const img2 = chart2.toDataURL("image/png", 1.0);
    doc.addImage(img2, "PNG", 110, yCharts, 85, 60);
    doc.text("Daily Revenue", 110, yCharts-2);
  }
  if(chart3){
    const img3 = chart3.toDataURL("image/png", 1.0);
    doc.addImage(img3, "PNG", 14, yCharts+70, 85, 60);
    doc.text("Barangay Distribution", 14, yCharts+68);
  }

  // === Top Barangays ===
  doc.setFontSize(12);
  doc.setTextColor(215, 40, 47);
  doc.text("Top Barangays", 110, yCharts+68);

  doc.setFontSize(9);
  doc.setTextColor(0,0,0);
  let yTable = yCharts + 76;
  const rows = (window.__analyticsBarangay || []).slice(0,8);
  rows.forEach((r, i)=>{
    doc.text(`${i+1}. ${r.barangay}`, 110, yTable + (i*6));
    doc.text(`${r.count}`, 180, yTable + (i*6), {align:"right"});
  });

  // === Footer ===
  doc.setFontSize(9);
  doc.setTextColor(150,150,150);
  doc.text("JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021", 14, 350);

  // === Filename with date range ===
  const fromEl = document.getElementById("anaFrom").value;
  const toEl   = document.getElementById("anaTo").value;
  let filename = "analytics_dashboard.pdf";
  if(fromEl && toEl){
    filename = `analytics_dashboard_${fromEl}_to_${toEl}.pdf`;
  }

  doc.save(filename);
}

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js">
function exportTrackingExcel(entries){
  if(!entries || entries.length === 0){
    alert("No entries to export.");
    return;
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers
  aoa.push(["Tracking #","Parcel Name","Barangay","Price","Status","Date"]);

  // Data rows
  entries.forEach(r=>{
    aoa.push([r.id, r.name||"", r.barangay||"", r.price||"", r.status||"", r.ts ? r.ts.toLocaleString() : ""]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Tracking Entries");
  XLSX.writeFile(wb, `tracking_entries_${Date.now()}.xlsx`);
}

function exportAnalyticsExcel(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers + data
  aoa.push(["Date","Tracking #","Parcel Name","Barangay","Price"]);
  window.__analyticsRows.forEach(r=>{
    aoa.push([r.ts.toLocaleDateString(), r.id, r.name, r.barangay, r.price]);
  });

  // Daily Summary
  aoa.push([]);
  aoa.push(["Daily Summary"]);
  (window.__analyticsDaily||[]).forEach(d=>{
    aoa.push([d.date, d.parcels, "", "", d.revenue]);
  });

  // Barangay Distribution
  aoa.push([]);
  aoa.push(["Barangay Distribution"]);
  (window.__analyticsBarangay||[]).forEach(b=>{
    aoa.push([b.barangay, b.count]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Analytics");
  XLSX.writeFile(wb, `analytics_export_${Date.now()}.xlsx`);
}

async function exportAnalyticsPDF(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", [216, 356]); // Legal size

  // === Header ===
  doc.setFontSize(16);
  doc.setTextColor(0,0,0);
  doc.text("JNK Express Padala", 14, 12);
  doc.setFontSize(10);
  doc.text(`Date Generated: ${new Date().toLocaleString()}`, 14, 18);

  // === KPIs ===
  doc.setFontSize(11);
  doc.setTextColor(215, 40, 47);
  doc.text("Key Metrics", 14, 30);

  doc.setTextColor(0,0,0);
  let kpiY = 38;
  doc.text(`Total Parcels: ${document.getElementById("kpiParcels").innerText}`, 14, kpiY);
  doc.text(`Total Revenue: ‚Ç±${document.getElementById("kpiRevenue").innerText}`, 110, kpiY);
  kpiY += 8;
  doc.text(`Average Price: ‚Ç±${document.getElementById("kpiAvg").innerText}`, 14, kpiY);
  doc.text(`Repeat Customers: ${document.getElementById("kpiRepeat").innerText}`, 110, kpiY);

  // === Charts ===
  const chart1 = document.getElementById("chartParcels");
  const chart2 = document.getElementById("chartRevenue");
  const chart3 = document.getElementById("chartBarangay");

  let yCharts = 60;
  if(chart1){
    const img1 = chart1.toDataURL("image/png", 1.0);
    doc.addImage(img1, "PNG", 14, yCharts, 85, 60);
    doc.text("Daily Parcels", 14, yCharts-2);
  }
  if(chart2){
    const img2 = chart2.toDataURL("image/png", 1.0);
    doc.addImage(img2, "PNG", 110, yCharts, 85, 60);
    doc.text("Daily Revenue", 110, yCharts-2);
  }
  if(chart3){
    const img3 = chart3.toDataURL("image/png", 1.0);
    doc.addImage(img3, "PNG", 14, yCharts+70, 85, 60);
    doc.text("Barangay Distribution", 14, yCharts+68);
  }

  // === Top Barangays ===
  doc.setFontSize(12);
  doc.setTextColor(215, 40, 47);
  doc.text("Top Barangays", 110, yCharts+68);

  doc.setFontSize(9);
  doc.setTextColor(0,0,0);
  let yTable = yCharts + 76;
  const rows = (window.__analyticsBarangay || []).slice(0,8);
  rows.forEach((r, i)=>{
    doc.text(`${i+1}. ${r.barangay}`, 110, yTable + (i*6));
    doc.text(`${r.count}`, 180, yTable + (i*6), {align:"right"});
  });

  // === Footer ===
  doc.setFontSize(9);
  doc.setTextColor(150,150,150);
  doc.text("JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021", 14, 350);

  // === Filename with date range ===
  const fromEl = document.getElementById("anaFrom").value;
  const toEl   = document.getElementById("anaTo").value;
  let filename = "analytics_dashboard.pdf";
  if(fromEl && toEl){
    filename = `analytics_dashboard_${fromEl}_to_${toEl}.pdf`;
  }

  doc.save(filename);
}

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">
function exportTrackingExcel(entries){
  if(!entries || entries.length === 0){
    alert("No entries to export.");
    return;
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers
  aoa.push(["Tracking #","Parcel Name","Barangay","Price","Status","Date"]);

  // Data rows
  entries.forEach(r=>{
    aoa.push([r.id, r.name||"", r.barangay||"", r.price||"", r.status||"", r.ts ? r.ts.toLocaleString() : ""]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Tracking Entries");
  XLSX.writeFile(wb, `tracking_entries_${Date.now()}.xlsx`);
}

function exportAnalyticsExcel(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers + data
  aoa.push(["Date","Tracking #","Parcel Name","Barangay","Price"]);
  window.__analyticsRows.forEach(r=>{
    aoa.push([r.ts.toLocaleDateString(), r.id, r.name, r.barangay, r.price]);
  });

  // Daily Summary
  aoa.push([]);
  aoa.push(["Daily Summary"]);
  (window.__analyticsDaily||[]).forEach(d=>{
    aoa.push([d.date, d.parcels, "", "", d.revenue]);
  });

  // Barangay Distribution
  aoa.push([]);
  aoa.push(["Barangay Distribution"]);
  (window.__analyticsBarangay||[]).forEach(b=>{
    aoa.push([b.barangay, b.count]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Analytics");
  XLSX.writeFile(wb, `analytics_export_${Date.now()}.xlsx`);
}

async function exportAnalyticsPDF(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", [216, 356]); // Legal size

  // === Header ===
  doc.setFontSize(16);
  doc.setTextColor(0,0,0);
  doc.text("JNK Express Padala", 14, 12);
  doc.setFontSize(10);
  doc.text(`Date Generated: ${new Date().toLocaleString()}`, 14, 18);

  // === KPIs ===
  doc.setFontSize(11);
  doc.setTextColor(215, 40, 47);
  doc.text("Key Metrics", 14, 30);

  doc.setTextColor(0,0,0);
  let kpiY = 38;
  doc.text(`Total Parcels: ${document.getElementById("kpiParcels").innerText}`, 14, kpiY);
  doc.text(`Total Revenue: ‚Ç±${document.getElementById("kpiRevenue").innerText}`, 110, kpiY);
  kpiY += 8;
  doc.text(`Average Price: ‚Ç±${document.getElementById("kpiAvg").innerText}`, 14, kpiY);
  doc.text(`Repeat Customers: ${document.getElementById("kpiRepeat").innerText}`, 110, kpiY);

  // === Charts ===
  const chart1 = document.getElementById("chartParcels");
  const chart2 = document.getElementById("chartRevenue");
  const chart3 = document.getElementById("chartBarangay");

  let yCharts = 60;
  if(chart1){
    const img1 = chart1.toDataURL("image/png", 1.0);
    doc.addImage(img1, "PNG", 14, yCharts, 85, 60);
    doc.text("Daily Parcels", 14, yCharts-2);
  }
  if(chart2){
    const img2 = chart2.toDataURL("image/png", 1.0);
    doc.addImage(img2, "PNG", 110, yCharts, 85, 60);
    doc.text("Daily Revenue", 110, yCharts-2);
  }
  if(chart3){
    const img3 = chart3.toDataURL("image/png", 1.0);
    doc.addImage(img3, "PNG", 14, yCharts+70, 85, 60);
    doc.text("Barangay Distribution", 14, yCharts+68);
  }

  // === Top Barangays ===
  doc.setFontSize(12);
  doc.setTextColor(215, 40, 47);
  doc.text("Top Barangays", 110, yCharts+68);

  doc.setFontSize(9);
  doc.setTextColor(0,0,0);
  let yTable = yCharts + 76;
  const rows = (window.__analyticsBarangay || []).slice(0,8);
  rows.forEach((r, i)=>{
    doc.text(`${i+1}. ${r.barangay}`, 110, yTable + (i*6));
    doc.text(`${r.count}`, 180, yTable + (i*6), {align:"right"});
  });

  // === Footer ===
  doc.setFontSize(9);
  doc.setTextColor(150,150,150);
  doc.text("JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021", 14, 350);

  // === Filename with date range ===
  const fromEl = document.getElementById("anaFrom").value;
  const toEl   = document.getElementById("anaTo").value;
  let filename = "analytics_dashboard.pdf";
  if(fromEl && toEl){
    filename = `analytics_dashboard_${fromEl}_to_${toEl}.pdf`;
  }

  doc.save(filename);
}

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js">
function exportTrackingExcel(entries){
  if(!entries || entries.length === 0){
    alert("No entries to export.");
    return;
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers
  aoa.push(["Tracking #","Parcel Name","Barangay","Price","Status","Date"]);

  // Data rows
  entries.forEach(r=>{
    aoa.push([r.id, r.name||"", r.barangay||"", r.price||"", r.status||"", r.ts ? r.ts.toLocaleString() : ""]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Tracking Entries");
  XLSX.writeFile(wb, `tracking_entries_${Date.now()}.xlsx`);
}

function exportAnalyticsExcel(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers + data
  aoa.push(["Date","Tracking #","Parcel Name","Barangay","Price"]);
  window.__analyticsRows.forEach(r=>{
    aoa.push([r.ts.toLocaleDateString(), r.id, r.name, r.barangay, r.price]);
  });

  // Daily Summary
  aoa.push([]);
  aoa.push(["Daily Summary"]);
  (window.__analyticsDaily||[]).forEach(d=>{
    aoa.push([d.date, d.parcels, "", "", d.revenue]);
  });

  // Barangay Distribution
  aoa.push([]);
  aoa.push(["Barangay Distribution"]);
  (window.__analyticsBarangay||[]).forEach(b=>{
    aoa.push([b.barangay, b.count]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Analytics");
  XLSX.writeFile(wb, `analytics_export_${Date.now()}.xlsx`);
}

async function exportAnalyticsPDF(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", [216, 356]); // Legal size

  // === Header ===
  doc.setFontSize(16);
  doc.setTextColor(0,0,0);
  doc.text("JNK Express Padala", 14, 12);
  doc.setFontSize(10);
  doc.text(`Date Generated: ${new Date().toLocaleString()}`, 14, 18);

  // === KPIs ===
  doc.setFontSize(11);
  doc.setTextColor(215, 40, 47);
  doc.text("Key Metrics", 14, 30);

  doc.setTextColor(0,0,0);
  let kpiY = 38;
  doc.text(`Total Parcels: ${document.getElementById("kpiParcels").innerText}`, 14, kpiY);
  doc.text(`Total Revenue: ‚Ç±${document.getElementById("kpiRevenue").innerText}`, 110, kpiY);
  kpiY += 8;
  doc.text(`Average Price: ‚Ç±${document.getElementById("kpiAvg").innerText}`, 14, kpiY);
  doc.text(`Repeat Customers: ${document.getElementById("kpiRepeat").innerText}`, 110, kpiY);

  // === Charts ===
  const chart1 = document.getElementById("chartParcels");
  const chart2 = document.getElementById("chartRevenue");
  const chart3 = document.getElementById("chartBarangay");

  let yCharts = 60;
  if(chart1){
    const img1 = chart1.toDataURL("image/png", 1.0);
    doc.addImage(img1, "PNG", 14, yCharts, 85, 60);
    doc.text("Daily Parcels", 14, yCharts-2);
  }
  if(chart2){
    const img2 = chart2.toDataURL("image/png", 1.0);
    doc.addImage(img2, "PNG", 110, yCharts, 85, 60);
    doc.text("Daily Revenue", 110, yCharts-2);
  }
  if(chart3){
    const img3 = chart3.toDataURL("image/png", 1.0);
    doc.addImage(img3, "PNG", 14, yCharts+70, 85, 60);
    doc.text("Barangay Distribution", 14, yCharts+68);
  }

  // === Top Barangays ===
  doc.setFontSize(12);
  doc.setTextColor(215, 40, 47);
  doc.text("Top Barangays", 110, yCharts+68);

  doc.setFontSize(9);
  doc.setTextColor(0,0,0);
  let yTable = yCharts + 76;
  const rows = (window.__analyticsBarangay || []).slice(0,8);
  rows.forEach((r, i)=>{
    doc.text(`${i+1}. ${r.barangay}`, 110, yTable + (i*6));
    doc.text(`${r.count}`, 180, yTable + (i*6), {align:"right"});
  });

  // === Footer ===
  doc.setFontSize(9);
  doc.setTextColor(150,150,150);
  doc.text("JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021", 14, 350);

  // === Filename with date range ===
  const fromEl = document.getElementById("anaFrom").value;
  const toEl   = document.getElementById("anaTo").value;
  let filename = "analytics_dashboard.pdf";
  if(fromEl && toEl){
    filename = `analytics_dashboard_${fromEl}_to_${toEl}.pdf`;
  }

  doc.save(filename);
}

</script>
<!-- QR Scanner -->
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js">
function exportTrackingExcel(entries){
  if(!entries || entries.length === 0){
    alert("No entries to export.");
    return;
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers
  aoa.push(["Tracking #","Parcel Name","Barangay","Price","Status","Date"]);

  // Data rows
  entries.forEach(r=>{
    aoa.push([r.id, r.name||"", r.barangay||"", r.price||"", r.status||"", r.ts ? r.ts.toLocaleString() : ""]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Tracking Entries");
  XLSX.writeFile(wb, `tracking_entries_${Date.now()}.xlsx`);
}

function exportAnalyticsExcel(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const aoa = [];
  // Header rows
  aoa.push(["JNK Express Padala"]);
  aoa.push([`Date Generated: ${new Date().toLocaleString()}`]);
  aoa.push([]);

  // Column headers + data
  aoa.push(["Date","Tracking #","Parcel Name","Barangay","Price"]);
  window.__analyticsRows.forEach(r=>{
    aoa.push([r.ts.toLocaleDateString(), r.id, r.name, r.barangay, r.price]);
  });

  // Daily Summary
  aoa.push([]);
  aoa.push(["Daily Summary"]);
  (window.__analyticsDaily||[]).forEach(d=>{
    aoa.push([d.date, d.parcels, "", "", d.revenue]);
  });

  // Barangay Distribution
  aoa.push([]);
  aoa.push(["Barangay Distribution"]);
  (window.__analyticsBarangay||[]).forEach(b=>{
    aoa.push([b.barangay, b.count]);
  });

  // Footer row
  aoa.push([]);
  aoa.push(["JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021"]);

  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Analytics");
  XLSX.writeFile(wb, `analytics_export_${Date.now()}.xlsx`);
}

async function exportAnalyticsPDF(){
  if(!window.__analyticsRows){ 
    alert("No analytics data loaded. Please refresh analytics first."); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", [216, 356]); // Legal size

  // === Header ===
  doc.setFontSize(16);
  doc.setTextColor(0,0,0);
  doc.text("JNK Express Padala", 14, 12);
  doc.setFontSize(10);
  doc.text(`Date Generated: ${new Date().toLocaleString()}`, 14, 18);

  // === KPIs ===
  doc.setFontSize(11);
  doc.setTextColor(215, 40, 47);
  doc.text("Key Metrics", 14, 30);

  doc.setTextColor(0,0,0);
  let kpiY = 38;
  doc.text(`Total Parcels: ${document.getElementById("kpiParcels").innerText}`, 14, kpiY);
  doc.text(`Total Revenue: ‚Ç±${document.getElementById("kpiRevenue").innerText}`, 110, kpiY);
  kpiY += 8;
  doc.text(`Average Price: ‚Ç±${document.getElementById("kpiAvg").innerText}`, 14, kpiY);
  doc.text(`Repeat Customers: ${document.getElementById("kpiRepeat").innerText}`, 110, kpiY);

  // === Charts ===
  const chart1 = document.getElementById("chartParcels");
  const chart2 = document.getElementById("chartRevenue");
  const chart3 = document.getElementById("chartBarangay");

  let yCharts = 60;
  if(chart1){
    const img1 = chart1.toDataURL("image/png", 1.0);
    doc.addImage(img1, "PNG", 14, yCharts, 85, 60);
    doc.text("Daily Parcels", 14, yCharts-2);
  }
  if(chart2){
    const img2 = chart2.toDataURL("image/png", 1.0);
    doc.addImage(img2, "PNG", 110, yCharts, 85, 60);
    doc.text("Daily Revenue", 110, yCharts-2);
  }
  if(chart3){
    const img3 = chart3.toDataURL("image/png", 1.0);
    doc.addImage(img3, "PNG", 14, yCharts+70, 85, 60);
    doc.text("Barangay Distribution", 14, yCharts+68);
  }

  // === Top Barangays ===
  doc.setFontSize(12);
  doc.setTextColor(215, 40, 47);
  doc.text("Top Barangays", 110, yCharts+68);

  doc.setFontSize(9);
  doc.setTextColor(0,0,0);
  let yTable = yCharts + 76;
  const rows = (window.__analyticsBarangay || []).slice(0,8);
  rows.forEach((r, i)=>{
    doc.text(`${i+1}. ${r.barangay}`, 110, yTable + (i*6));
    doc.text(`${r.count}`, 180, yTable + (i*6), {align:"right"});
  });

  // === Footer ===
  doc.setFontSize(9);
  doc.setTextColor(150,150,150);
  doc.text("JNK Express Padala ‚Ä¢ Trusted Service for Lubangenos ‚Ä¢ ¬©2021", 14, 350);

  // === Filename with date range ===
  const fromEl = document.getElementById("anaFrom").value;
  const toEl   = document.getElementById("anaTo").value;
  let filename = "analytics_dashboard.pdf";
  if(fromEl && toEl){
    filename = `analytics_dashboard_${fromEl}_to_${toEl}.pdf`;
  }

  doc.save(filename);
}

</script>

<link href="styles.css" rel="stylesheet"/></head>
<body>
<div class="wrap">
<h2>JNK Admin Panel</h2>
<!-- LOGIN -->
<div class="card" id="loginSection">
<div class="grid two">
<div>
<label class="small muted">Username</label>
<input autocomplete="username" id="username" placeholder="Username" type="text"/>
</div>
<div>
<label class="small muted">Password</label>
<input autocomplete="current-password" id="password" placeholder="Password" type="password"/>
</div>
</div>
<div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
<button onclick="login()">Login</button>
<div class="muted small">Use correct credentials to access admin features.</div>
</div>
<p id="loginMessage" style="color:#b61e24; margin:8px 2px 0;"></p>
</div>
<!-- APP -->
<div id="appSection" style="display:none; margin-top:16px;">
<div class="tabs">
<button class="tab-btn active" id="tabManageBtn" onclick="showTab('manage')">Manage</button>
<button class="tab-btn" id="tabProductsBtn" onclick="showTab('products')">Products</button>
<button class="tab-btn" id="tabLoyaltyBtn" onclick="showTab('loyalty')">Loyalty</button>
<button class="tab-btn" id="tabAnalyticsBtn" onclick="showTab('analytics')">Analytics</button>
<div style="flex:1"></div>
<button class="tab-btn" onclick="logout()">Logout</button>
</div>
<!-- MANAGE SECTION -->
<div class="section show" id="manageSection">
<div class="card">
<h3>Add / Update Tracking Entry</h3>
<div class="grid two">
<input id="trackNumber" placeholder="Tracking Number" type="text"/>
<input id="parcelName" placeholder="Parcel Name (customer or item name)" type="text"/>
<input id="barangay" placeholder="Barangay" type="text"/>
<input id="price" placeholder="Price (PHP)" type="number"/>
<select id="trackStatus">
<option value="">Select Status</option>
<option>Package Received</option>
<option>In Transit</option>
<option>Arrived</option>
<option>For Pick-up</option>
</select>
<input id="trackLocation" placeholder="Location (e.g., Manila Hub)" type="text"/>
<input id="estimatedDate" type="date"/>
</div>
<div class="top-bar" style="margin-top:12px;">
<button onclick="saveTracking()">Add / Update</button>
<button id="printReceiptBtn">üñ®Ô∏è Print Receipt</button>
<button onclick="startScanner()">üì∑ Scan</button>
<div style="flex:1"></div>
<div class="muted small">Tip: scan QR to autofill tracking number and print</div>
</div>
<div id="scannerContainer" style="display:none; margin-top:10px;">
<div id="scanner" style="width:100%"></div>
<div style="margin-top:8px;"><button class="delete-btn" onclick="stopScanner()">‚ùå Cancel</button></div>
</div>
</div>
<div class="card" style="margin-top:14px;">
<div class="top-bar">
<input id="searchInput" placeholder="Search tracking number..." type="text"/>
<button onclick="currentPage=1; renderEntries()">üîç Search</button>
<div style="flex:1"></div>
<button onclick="loadAllEntries()">Refresh List</button>
</div>
</div>
<div class="card" style="margin-top:14px;">
<div class="top-bar">
<input id="excelFrom" type="date"/>
<input id="excelTo" type="date"/>
<button onclick="exportExcelByDateRange()">üìä Export Excel (4 cols + totals)</button>
</div>
</div>
<div class="card" style="margin-top:14px;">
<h3>Bulk Update by Time Range</h3>
<div class="grid two">
<div>
<label class="small muted">From</label>
<input id="bulkFromDate" type="date"/>
<input id="bulkFromTime" type="time"/>
</div>
<div>
<label class="small muted">To</label>
<input id="bulkToDate" type="date"/>
<input id="bulkToTime" type="time"/>
</div>
<select id="bulkStatus">
<option value="">Update Status to...</option>
<option>Package Received</option>
<option>In Transit</option>
<option>Arrived</option>
<option>For Pick-up</option>
</select>
<input id="bulkLocation" placeholder="Optional New Location" type="text"/>
</div>
<div style="margin-top:10px;">
<button onclick="bulkUpdateByTimeRange()">Apply Bulk Update</button>
</div>
</div>
<div style="margin-top:14px;">
<h3>All Tracking Entries</h3>
<div id="entries"></div>
<div class="pagination">
<button onclick="prevPage()">Previous</button>
<button onclick="nextPage()">Next</button>
</div>
</div>
</div>
<!-- PRODUCTS SECTION -->
<div class="section" id="productsSection">
<div class="card">
<h3>Products (Beauty / Clothes)</h3>
<div class="grid two">
<input id="prodBarcode" placeholder="Barcode / SKU (scan or type)" type="text"/>
<input id="prodName" placeholder="Product Name" type="text"/>
<select id="prodCategory">
<option value="">Select Category</option>
<option>Beauty</option>
<option>Clothes</option>
</select>
<input id="prodPrice" placeholder="Price (PHP)" type="number"/>
<input id="prodStock" placeholder="Stock Quantity" type="number"/>
<input id="prodNotes" placeholder="Notes (optional)" type="text"/>
</div>
<div class="top-bar" style="margin-top:10px;">
<button onclick="saveProduct()">Save Product</button>
<button onclick="startProductScanner()">Scan Product</button>
<div style="flex:1"></div>
<button onclick="loadProducts()">Refresh Products</button>
</div>
</div>
<div class="card" style="margin-top:14px;">
<h4>Product List</h4>
<div id="productList"></div>
<div style="margin-top:10px;">
<button onclick="exportProductsExcel()">Export Products</button>
</div>
</div>
<div class="card" style="margin-top:14px;">
<h4>Record Sale</h4>
<div class="grid two">
<input id="saleBarcode" placeholder="Barcode (scan or type)"/>
<input id="saleQty" placeholder="Quantity" type="number" value="1"/>
<input id="saleBuyer" placeholder="Buyer name (optional)"/>
<input id="saleNote" placeholder="Note (optional)"/>
</div>
<div class="top-bar" style="margin-top:10px;">
<button onclick="recordSale()">Record Sale</button>
<button onclick="startSaleScanner()">Scan to Sell</button>
<div style="flex:1"></div>
<button onclick="loadSales()">Load Sales</button>
</div>
<div style="margin-top:14px;">
<h4>Recent Sales</h4>
<div id="salesList"></div>
</div>
</div>
<div class="card" style="margin-top:14px;">
<h3>Sales Analytics (Products)</h3>
<div class="top-bar">
<input id="prodAnaFrom" type="date"/>
<input id="prodAnaTo" type="date"/>
<button onclick="loadProductAnalytics()">Refresh</button>
<button onclick="quickProductRange('month')">This Month</button>
<button onclick="quickProductRange('lastmonth')">Last Month</button>
</div>
<div class="kpis" style="margin-top:12px;">
<div class="kpi"><div class="label">Total Products Sold</div><div class="value" id="pKpiSold">0</div></div>
<div class="kpi"><div class="label">Total Sales (‚Ç±)</div><div class="value" id="pKpiRevenue">0</div></div>
<div class="kpi"><div class="label">Avg Sale Value (‚Ç±)</div><div class="value" id="pKpiAvg">0</div></div>
<div class="kpi"><div class="label">Top Category</div><div class="value" id="pKpiTopCat">-</div></div>
</div>
<div class="grid two" style="margin-top:12px;">
<div class="chart-card">
<h4 style="margin:0 0 8px;">Top Products</h4>
<canvas height="180" id="chartTopProducts"></canvas>
</div>
<div class="chart-card">
<h4 style="margin:0 0 8px;">Category Distribution</h4>
<canvas height="180" id="chartCategory"></canvas>
</div>
</div>
</div>
</div>
<!-- LOYALTY SECTION -->
<div class="section" id="loyaltySection">
<div class="card">
<h3>Register Loyalty Card</h3>
<div class="loyalty-grid two">
<div>
<label class="small muted">Card ID / Barcode</label>
<input id="loyCardId" placeholder="Scan or type card ID" type="text"/>
</div>
<div>
<label class="small muted">Scan Card</label>
<div style="display:flex; gap:8px;">
<button onclick="startLoyaltyScanner()">Scan Card</button>
<button onclick="stopLoyaltyScanner()">Stop</button>
</div>
</div>
<div>
<label class="small muted">Full Name</label>
<input id="loyName" placeholder="Customer's full name" type="text"/>
</div>
<div>
<label class="small muted">Phone Number</label>
<input id="loyPhone" placeholder="09XXXXXXXXX" type="text"/>
</div>
<div style="grid-column: 1 / -1;">
<label class="small muted">Complete Address</label>
<input id="loyAddress" placeholder="House/Street, Brgy, City, Province" type="text"/>
</div>
</div>
<div class="top-bar" style="margin-top:10px;">
<button onclick="registerLoyalty()">Register Card</button>
<button onclick="loadLoyaltyMembers()">Refresh Members</button>
<div style="flex:1"></div>
<div class="muted small">Registered customers only: points awarded for registered names on tracking entries.</div>
</div>
<div id="loyaltyScannerContainer" style="display:none; margin-top:10px;">
<div id="loyaltyScanner" style="width:100%"></div>
</div>
</div>
<div class="card" style="margin-top:14px;">
<h3>Loyalty Members</h3>
<div class="top-bar">
<input id="loySearch" placeholder="Search by name, phone or card ID..." type="text"/>
<button onclick="renderLoyaltyList()">üîç Search</button>
<div style="flex:1"></div>
<button onclick="exportLoyaltyExcel()">Export Loyalty (Excel)</button>
</div>
<div id="loyaltyList" style="margin-top:12px;"></div>
</div>
</div>
<!-- ANALYTICS SECTION -->
<div class="section" id="analyticsSection">
<div class="card">
<h3>Analytics</h3>
<div class="top-bar">
<input id="anaFrom" type="date"/>
<input id="anaTo" type="date"/>
<button onclick="loadAnalytics()">Refresh</button>
<button onclick="quickRange('today')">Today</button>
<button onclick="quickRange('week')">This Week</button>
<button onclick="quickRange('month')">This Month</button>
</div>
</div>
<div class="kpis" style="margin-top:14px;">
<div class="kpi"><div class="label">Total Parcels</div><div class="value" id="kpiParcels">0</div></div>
<div class="kpi"><div class="label">Total Revenue (‚Ç±)</div><div class="value" id="kpiRevenue">0</div></div>
<div class="kpi"><div class="label">Average Price (‚Ç±)</div><div class="value" id="kpiAvg">0</div></div>
<div class="kpi"><div class="label">Repeat Customers</div><div class="value" id="kpiRepeat">0</div></div>
</div>
<div class="grid two" style="margin-top:14px;">
<div class="chart-card">
<h4 style="margin:0 0 8px;">Daily Parcel Count</h4>
<canvas height="120" id="chartParcels"></canvas>
</div>
<div class="chart-card">
<h4 style="margin:0 0 8px;">Daily Revenue (‚Ç±)</h4>
<canvas height="120" id="chartRevenue"></canvas>
</div>
</div>
<div class="grid two" style="margin-top:14px;">
<div class="chart-card">
<h4 style="margin:0 0 8px;">Barangay Distribution</h4>
<canvas height="140" id="chartBarangay"></canvas>
</div>
<div class="card">
<h4 style="margin:0 0 8px;">Top Barangays</h4>
<table class="table" id="topBarangaysTable">
<thead><tr><th>Barangay</th><th>Parcels</th></tr></thead>
<tbody></tbody>
</table>
<div class="top-bar" style="margin-top:10px;">
<button onclick="exportAnalyticsExcel()">Export Analytics (Excel)</button>
<button onclick="exportAnalyticsPDF()">Export Analytics (PDF)</button>
</div>
</div>
</div>
</div>
</div>
<!-- Hidden print receipt area -->
<div id="receiptArea"><div id="receiptContent" style="font-family:monospace; font-size:10pt;"></div></div>
</div>

<script src="app.js"></script></body>
</html>
